<!DOCTYPE html>
<html lang='zh-CN'>

<head>
  <meta name="generator" content="Hexo 6.3.0">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.19.0">
  <meta charset="utf-8">
  

  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://gcore.jsdelivr.net'>
  <link rel="preconnect" href="https://gcore.jsdelivr.net" crossorigin>
  <link rel='dns-prefetch' href='//unpkg.com'>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  
  <title>Vue 实现课程表和选课工具 - もじもんの文字門</title>

  
    <meta name="description" content="项目仓库：cityu-cs&#x2F;cityu-cs.github.io 部署地址：cityu-cs.github.io">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue 实现课程表和选课工具">
<meta property="og:url" content="https://mojimoon.github.io/2023/Vue/index.html">
<meta property="og:site_name" content="もじもんの文字門">
<meta property="og:description" content="项目仓库：cityu-cs&#x2F;cityu-cs.github.io 部署地址：cityu-cs.github.io">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-10-06T00:00:00.000Z">
<meta property="article:modified_time" content="2023-10-16T07:01:04.211Z">
<meta property="article:author" content="mojimoon">
<meta property="article:tag" content="mojimoon, computer science, python, blog, hexo">
<meta name="twitter:card" content="summary">
  
  
  
  <meta name="keywords" content="mojimoon, computer science, python, blog, hexo">

  <!-- feed -->
  

  
    
<link rel="stylesheet" href="/css/main.css">

  

  
    <link rel="shortcut icon" href="/image/favicon.png">
  

  

  


  
    
      <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC&display=swap" rel="stylesheet">
    
      <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
    
      <link rel="stylesheet" href="/css/override.css">
    
  
</head>

<body>
  




  <div class='l_body' id='start'>
    <aside class='l_left' layout='post'>
    

  

<header class="header"><div class="logo-wrap"><a class="title" href="/"><div class="main" ff="title">もじもんの文字門</div><div class="sub normal cap">City University of Hong Kong</div><div class="sub hover cap" style="opacity:0"> Computer Science</div></a></div>

<nav class="menu dis-select"></nav>
</header>


<div class="widgets">
<widget class="widget-wrapper search"><div class="widget-body"><div class="search-wrapper" id="search"><form class="search-form"><input type="text" class="search-input" id="search-input" data-filter="/blog/" placeholder="文章搜索"><svg t="1670596976048" class="icon search-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2676" width="200" height="200"><path d="M938.2 832.6L723.8 618.1c-2.5-2.5-5.3-4.4-7.9-6.4 36.2-55.6 57.3-121.8 57.3-193.1C773.3 222.8 614.6 64 418.7 64S64 222.8 64 418.6c0 195.9 158.8 354.6 354.6 354.6 71.3 0 137.5-21.2 193.2-57.4 2 2.7 3.9 5.4 6.3 7.8L832.5 938c14.6 14.6 33.7 21.9 52.8 21.9 19.1 0 38.2-7.3 52.8-21.8 29.2-29.1 29.2-76.4 0.1-105.5M418.7 661.3C284.9 661.3 176 552.4 176 418.6 176 284.9 284.9 176 418.7 176c133.8 0 242.6 108.9 242.6 242.7 0 133.7-108.9 242.6-242.6 242.6" p-id="2677"></path></svg></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div></div></widget>


<widget class="widget-wrapper toc single" id="data-toc"><div class="widget-header cap dis-select"><span class="name">Vue 实现课程表和选课工具</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-text"> 背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%92%8C%E5%B7%A5%E5%85%B7"><span class="toc-text"> 环境和工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-text"> 准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E6%95%B0%E6%8D%AE"><span class="toc-text"> 课程数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E8%AF%BE%E7%A8%8B%E6%95%B0%E6%8D%AE"><span class="toc-text"> 处理课程数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE"><span class="toc-text"> 数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#courselistjson"><span class="toc-text"> CourseList.json</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#coursedetailjson"><span class="toc-text"> CourseDetail.json</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD"><span class="toc-text"> 功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E5%88%97%E8%A1%A8"><span class="toc-text"> 课程列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#template"><span class="toc-text"> &lt;template&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#script"><span class="toc-text"> &lt;script&gt;</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E8%AF%A6%E6%83%85"><span class="toc-text"> 课程详情</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#template-2"><span class="toc-text"> &lt;template&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#script-2"><span class="toc-text"> &lt;script&gt;</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E8%A1%A8"><span class="toc-text"> 课程表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#template-3"><span class="toc-text"> &lt;template&gt;</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#script-3"><span class="toc-text"> &lt;script&gt;</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%82%E9%A1%B9"><span class="toc-text"> 杂项</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#localstorage"><span class="toc-text"> LocalStorage</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text"> 初始化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-text"> 结语</span></a></li></ol></div></div></widget>




</div>


    </aside>
    <div class='l_main'>
      

      



<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a><span class="sep"></span><a class="cap breadcrumb" href="/">文章</a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/Tech/">Tech</a></div><div id="post-meta">发布于&nbsp;<time datetime="2023-10-06T00:00:00.000Z">2023-10-06</time></div></div>

<article class='md-text content post'>
<h1 class="article-title"><span>Vue 实现课程表和选课工具</span></h1>
<ul>
<li>项目仓库：<a target="_blank" rel="noopener" href="https://github.com/cityu-cs/cityu-cs.github.io">cityu-cs/cityu-cs.github.io</a></li>
<li>部署地址：<a target="_blank" rel="noopener" href="https://cityu-cs.github.io/">cityu-cs.github.io</a></li>
</ul>
<span id="more"></span>
<h2 id="背景"><a class="markdownIt-Anchor" href="#背景"></a> 背景</h2>
<p>暑假实习期间写的项目。</p>
<p>虽然 CityU 有一个历史悠久的第三方选课工具 <a target="_blank" rel="noopener" href="https://festivaljog.com/">Festival Jog</a>，但是同个作者正在开发中的 <a target="_blank" rel="noopener" href="https://ftjog.com/">新版</a> 令人一言难尽（尽管我知道还在开发中，但是交互体验下降了很多），我就想着自己写一个也不是很难。</p>
<h2 id="环境和工具"><a class="markdownIt-Anchor" href="#环境和工具"></a> 环境和工具</h2>
<ul>
<li>环境：Node.js v16.17.0</li>
<li>框架：Vue 3.3.4 + Vite 4.4.6</li>
<li>UI 库：Element Plus 2.0.6</li>
<li>IDE：WebStorm 2023.1</li>
<li>部署：GitHub Pages</li>
</ul>
<p>使用组合式 API (Composition API) 编写。</p>
<p>使用 Event Bus 进行组件间通信。</p>
<p>组合式 API 更符合我的习惯，但是网上大部分教程都是基于选项式 API (Options API) 的（因为 Vue 2.x 默认使用选项式 API），所以有很多地方都是自己摸索的。</p>
<h2 id="准备工作"><a class="markdownIt-Anchor" href="#准备工作"></a> 准备工作</h2>
<h3 id="课程数据"><a class="markdownIt-Anchor" href="#课程数据"></a> 课程数据</h3>
<p>从 AIMS 获取课程数据。</p>
<p>要想直接从 HTML 中获取课程数据是不可能的，因为学校网站都强制 2FA 登录。</p>
<p>模拟浏览器的 Selenium 是可行的，但是因为效率低下，只作为不得已的方案。</p>
<p>不过，通过 F12 的 Network 面板，可以找到获取数据的 Fetch/XHR 请求，提取 API 地址，这样就能不登录直接获取数据了。</p>
<p>可以参考<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/346965631">这则问答</a>。</p>
<h3 id="处理课程数据"><a class="markdownIt-Anchor" href="#处理课程数据"></a> 处理课程数据</h3>
<p>爬取完成后，得到上千个 <code>.json</code> 文件，每个文件包含一个课程的具体信息。</p>
<p>为了方便后续处理，需要将这些 <code>.json</code> 文件合并成一个大的 <code>.json</code> 文件。</p>
<p>这里我犯了很大的错误，导致后面不得不反复写 python 代码修改文件结构。</p>
<p>结论而言，在 <code>json</code> 中尽量不要用数组，尤其是嵌套的数组。</p>
<p>比如，要标记 <code>CS1102</code> 和 <code>CS1302</code> 的科目为 <code>CS</code>，不应该这样写：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;subjects&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;CS&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CS1102&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Introduction to Computer Studies&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CS1302&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Introduction to Computer Programming&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>这样 <code>CS</code> 就是一个数组，而不是一个对象，会导致后续处理非常麻烦。</p>
<p>正确的作法是把 <code>CS</code> 作为各个 course 对象的属性，这样就能直接用 <code>for...in</code> 遍历了。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;courses&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;CS1102&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CS1102&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Introduction to Computer Studies&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;subject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CS&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;CS1302&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CS1302&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Introduction to Computer Programming&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;subject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CS&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="数据"><a class="markdownIt-Anchor" href="#数据"></a> 数据</h2>
<p>经过准备工作，得到两个 <code>.json</code> 文件：</p>
<ul>
<li><code>CourseList.json</code>：所有课程的基础信息，包括科目代码、科目名称、学分、是否支持线上选课。</li>
<li><code>CourseDetail.json</code>：所有课程的具体信息，包括各个 session 的 CRN、上课时间、上课地点、选课限制等。</li>
</ul>
<h3 id="courselistjson"><a class="markdownIt-Anchor" href="#courselistjson"></a> <code>CourseList.json</code></h3>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;subject&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;AC&quot;</span><span class="punctuation">,</span><span class="string">&quot;ADSE&quot;</span><span class="punctuation">,</span> <span class="comment">// ...</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;course&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;courseCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AC4161&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;courseTitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Accounting Information Systems and Emerging Technologies&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;creditUnits&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;webEnabled&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Y&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;courseLevel&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;B&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;subject&quot;</span><span class="punctuation">:</span><span class="string">&quot;AC&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>subject</code>：所有学科代码的数组。这个数组让页面直接知道有哪些学科，方便筛选。实际生产中，这个数组应该是动态生成的。</li>
<li><code>course</code>：所有课程基础信息的数组。</li>
</ul>
<h3 id="coursedetailjson"><a class="markdownIt-Anchor" href="#coursedetailjson"></a> <code>CourseDetail.json</code></h3>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;AC3202&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;subjectCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AC&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;courseCode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AC3202&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;courseTitle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Corporate Accounting I&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;creditUnits&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;courseLevel&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;B&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;activities&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;crn&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10011&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;day&quot;</span><span class="punctuation">:</span> <span class="string">&quot;T&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;startTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;09:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;endTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;11:50&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;bldg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;YEUNG&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;room&quot;</span><span class="punctuation">:</span> <span class="string">&quot;G4702&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;section&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;web&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span><span class="attr">&quot;0&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;only for Major: AC&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span><span class="attr">&quot;A&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;only for Minor: AC&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span><span class="attr">&quot;B&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;only for College: CB&quot;</span><span class="punctuation">,</span><span class="string">&quot;not for Major: AC&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>每个课程作为一个对象，对象的 key 是课程代码。</li>
<li>有部分信息是和课程基础信息重复的，因为传参时只有一个 <code>courseCode</code>，直接通过 <code>CourseDetail[courseCode]</code> 就能获取到所有信息。</li>
<li><code>activities</code>：所有 session 的数组。</li>
<li><code>category</code>：每个 category 的选课限制。和 <code>activities[]</code> 中的 <code>category</code> 对应。在原始数据中，每个 session 都有独立的选课限制。由于 category 相同的 session 一般都是同一种限制，并且下面的课程详情表是按照 category 分组的，所以这里把 category 作为 key，把限制信息作为 value，放在一个数组中。</li>
</ul>
<h2 id="功能"><a class="markdownIt-Anchor" href="#功能"></a> 功能</h2>
<h3 id="课程列表"><a class="markdownIt-Anchor" href="#课程列表"></a> 课程列表</h3>
<p>显示所有课程的表格，包括课程代码、课程名称、学分、是否支持线上选课，和查阅官网、查看 session 的两个按钮。</p>
<ul>
<li>支持用课程代码、课程名称、学科、课程级别进行搜索和筛选。</li>
<li>支持分页、快速跳转、自定义每页数量。</li>
<li>在输入框中回车或点击搜索按钮时，会触发搜索。</li>
</ul>
<h4 id="template"><a class="markdownIt-Anchor" href="#template"></a> <code>&lt;template&gt;</code></h4>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;search-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">class</span>=<span class="string">&quot;search-input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Course Code or Title&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;queryText&quot;</span> <span class="attr">clearable</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">keyup.enter.native</span>=<span class="string">&quot;search&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span> <span class="comment">&lt;!-- 输入框 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">class</span>=<span class="string">&quot;search-select&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;querySubject&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Subject&quot;</span> <span class="attr">clearable</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">v-for</span>=<span class="string">&quot;item in subjectList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.value&quot;</span> <span class="attr">:label</span>=<span class="string">&quot;item.label&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;item.value&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span> <span class="comment">&lt;!-- 学科筛选 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">class</span>=<span class="string">&quot;search-select&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;queryLevel&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Level&quot;</span> <span class="attr">clearable</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">v-for</span>=<span class="string">&quot;item in levelList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.value&quot;</span> <span class="attr">:label</span>=<span class="string">&quot;item.label&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;item.value&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span> <span class="comment">&lt;!-- 课程级别筛选 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">class</span>=<span class="string">&quot;search-button&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;search&quot;</span>&gt;</span>Search<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span> <span class="comment">&lt;!-- 搜索按钮 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="script"><a class="markdownIt-Anchor" href="#script"></a> <code>&lt;script&gt;</code></h4>
<p>上面的 HTML 代码中出现了很多变量，先定义一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queryText = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> querySubject = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> queryLevel = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>这里就要说到 Vue 一个很重要的概念：<strong>响应式</strong>。虽然变量是用 <code>const</code> 定义的，但是它们实质是 Vue 提供的一个 reference，类似于 C 中的 <code>const int *</code>，其指向的对象不可变，但是对象本身是可变的。</p>
<p>当输入框中的文本发生变化时，<code>queryText</code> 会自动更新，而不需要像原生 JS 一样手动监听 <code>input</code> 事件。</p>
<p>搜索功能：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">search</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> query = queryText.<span class="property">value</span>.<span class="title function_">toLowerCase</span>();</span><br><span class="line">    <span class="keyword">const</span> subject = querySubject.<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">const</span> level = queryLevel.<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (!query &amp;&amp; !subject &amp;&amp; !level) &#123; <span class="comment">// 无筛选条件时显示全部课程</span></span><br><span class="line">        resultList.<span class="property">value</span> = fullList.<span class="property">value</span>;</span><br><span class="line">        total.<span class="property">value</span> = resultList.<span class="property">value</span>.<span class="property">length</span>;</span><br><span class="line">        <span class="title function_">updateCurrentList</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    resultList.<span class="property">value</span> = fullList.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">course</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (query &amp;&amp; !course.<span class="property">courseCode</span>.<span class="title function_">toLowerCase</span>().<span class="title function_">includes</span>(query) &amp;&amp; !course.<span class="property">courseTitle</span>.<span class="title function_">toLowerCase</span>().<span class="title function_">includes</span>(query)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (subject &amp;&amp; course.<span class="property">subject</span> !== subject) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (level &amp;&amp; !course.<span class="property">courseLevel</span>.<span class="title function_">includes</span>(level)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    total.<span class="property">value</span> = resultList.<span class="property">value</span>.<span class="property">length</span>;</span><br><span class="line">    <span class="title function_">updateCurrentList</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>filter()</code> 方法返回一个新数组，新数组中的元素是原数组中符合条件的元素。类似于 Java 中的 <code>stream().filter()</code>。</p>
<p>分页功能：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pagesize = <span class="title function_">ref</span>(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">const</span> currentPage = <span class="title function_">ref</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> total = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleSizeChange</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    pagesize.<span class="property">value</span> = val;</span><br><span class="line">    currentPage.<span class="property">value</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="title function_">updateCurrentList</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleCurPageChange</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    currentPage.<span class="property">value</span> = val;</span><br><span class="line">    <span class="title function_">updateCurrentList</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">updateCurrentList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> start = (currentPage.<span class="property">value</span> - <span class="number">1</span>) * pagesize.<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">const</span> end = start + pagesize.<span class="property">value</span>;</span><br><span class="line">    currentList.<span class="property">value</span> = resultList.<span class="property">value</span>.<span class="title function_">slice</span>(start, end);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分页的思路其实很简单：只要知道完整的数组，就能根据当前页码和每页数量计算出当前页首尾元素的下标。</p>
<p>当 <code>end</code> 下标超出数组长度时，<code>slice()</code> 方法会自动截断，所以不需要额外处理。</p>
<h3 id="课程详情"><a class="markdownIt-Anchor" href="#课程详情"></a> 课程详情</h3>
<p>点击课程列表中的查看按钮，下方的表格会显示该课程的所有 session。</p>
<ul>
<li>根据 category 分组，使用 tab 切换。</li>
<li>显示每个 category 对应的选课限制。</li>
</ul>
<h4 id="template-2"><a class="markdownIt-Anchor" href="#template-2"></a> <code>&lt;template&gt;</code></h4>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tab-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-tabs</span> <span class="attr">value</span>=<span class="string">&quot;activeTab&quot;</span> @<span class="attr">tab-click</span>=<span class="string">&quot;handleTabClick&quot;</span> <span class="attr">:type</span>=<span class="string">&quot;&#x27;card&#x27;&quot;</span>&gt;</span> <span class="comment">&lt;!-- tab 切换 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-tab-pane</span> <span class="attr">v-for</span>=<span class="string">&quot;item in tabs&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item&quot;</span> <span class="attr">:label</span>=<span class="string">&quot;item&quot;</span> <span class="attr">:name</span>=<span class="string">&quot;item&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-tab-pane</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-tabs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;restrictions[activeTab] !== undefined&quot;</span>&gt;</span>Restriction:<span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="comment">&lt;!-- 选课限制 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in restrictions[activeTab]&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-table</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:data</span>=<span class="string">&quot;tableItems[activeTab]&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">border</span></span></span><br><span class="line"><span class="tag">                <span class="attr">stripe</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:header-cell-style</span>=<span class="string">&quot;&#123;background:&#x27;#d9e5fd&#x27;, color:&#x27;black&#x27;, fontWeight: 1000&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:row-style</span>=<span class="string">&quot;&#123;height: &#x27;0&#x27;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:cell-style</span>=<span class="string">&quot;&#123;padding: &#x27;0&#x27;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">class</span>=<span class="string">&quot;table-short&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;crn&quot;</span> <span class="attr">label</span>=<span class="string">&quot;CRN&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">class</span>=<span class="string">&quot;table-short&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;section&quot;</span> <span class="attr">label</span>=<span class="string">&quot;Section&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">class</span>=<span class="string">&quot;table-medium&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;dayTime&quot;</span> <span class="attr">label</span>=<span class="string">&quot;Time&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">class</span>=<span class="string">&quot;table-medium&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;buildingRoom&quot;</span> <span class="attr">label</span>=<span class="string">&quot;Venue&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">class</span>=<span class="string">&quot;table-short&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;webEnabled&quot;</span> <span class="attr">label</span>=<span class="string">&quot;Web&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">clash</span>=<span class="string">&quot;table-short&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;status&quot;</span> <span class="attr">label</span>=<span class="string">&quot;Status&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;&#123;row&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;sectionStatus[row.crn]&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">class</span>=<span class="string">&quot;table-medium&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;add&quot;</span> <span class="attr">label</span>=<span class="string">&quot;Action&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;&#123;row&#125;&quot;</span>&gt;</span> <span class="comment">&lt;!-- 根据不同状态显示不同按钮 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addToTimetable(row)&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;sectionStatus[row.crn] === &#x27;OK&#x27;&quot;</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-else-if</span>=<span class="string">&quot;sectionStatus[row.crn] === &#x27;Added&#x27;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;deleteFromDetail(row)&quot;</span>&gt;</span>Remove<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">disabled</span> <span class="attr">v-else</span>&gt;</span>&#123;&#123;sectionStatus[row.crn]&#125;&#125;<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>tableItems[]</code> 是一个 key 为 category，value 为 session 数组的对象。例如，在上面 <code>AC3202</code> 的例子中，<code>tableItems['0']</code> 就是 <code>AC3202</code> 的所有 <code>category 0</code> 的 session。</li>
<li>Vue 解析 <code>el-table</code> 中的 <code>width: xx%</code> 时有 bug，<a target="_blank" rel="noopener" href="https://blog.csdn.net/xh_jing/article/details/120173863">参考文章</a>。解决方案是用 <code>min-width</code> 代替 <code>width</code>, <code>min-width</code> 的值是几，就代表占几份宽度。</li>
<li><code>&lt;template #default=&quot;&#123;row&#125;&quot;&gt;</code> 相当于一个匿名函数，参数是当前所在行 <code>row</code>，返回值是一个 HTML 元素，用于渲染当前单元格的内容。</li>
<li>这里使用 <code>&#123;&#123;sectionStatus[row.crn]&#125;&#125;</code> （直接访问值而不是调用函数）是因为最后一列的 action 按钮会根据 <code>sectionStatus</code> 显示不同的内容，所以必须要保存这个值而不是当场计算。</li>
<li>因此，只要在创建表格，增加、删除课程时更新所有 <code>sectionStatus</code> 的值，就能保证表格中的内容是最新的。</li>
</ul>
<h4 id="script-2"><a class="markdownIt-Anchor" href="#script-2"></a> <code>&lt;script&gt;</code></h4>
<p>以下几个方法实现比较简单，就不贴代码了：</p>
<ul>
<li><code>getDetail()</code>：在课程列表中点击查看按钮时调用，根据课程代码获取课程详情。</li>
<li><code>handleTabClick()</code>：点击 tab 时调用，改变当前 tab，显示对应的 session。</li>
<li><code>addToTimetable()</code>：点击添加按钮时调用，将 session 添加到课程表中。</li>
<li><code>deleteFromDetail()</code>：点击删除按钮时调用，将 session 从课程表中删除。</li>
</ul>
<p>此处增删操作会调用 <code>updateSectionStatus()</code> 和 <code>saveLocalStorage()</code>，更新各个 session 的状态，并保存修改到 LocalStorage。</p>
<p>更新所有 <code>sectionStatus</code> 的值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getAllStatus</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (activeTab.<span class="property">value</span> === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> act <span class="keyword">of</span> tableItems.<span class="property">value</span>[activeTab.<span class="property">value</span>]) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> added <span class="keyword">of</span> timetableList.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (added.<span class="property">crn</span> === act.<span class="property">crn</span>) &#123;</span><br><span class="line">                sectionStatus.<span class="property">value</span>[act.<span class="property">crn</span>] = <span class="string">&#x27;Added&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (added.<span class="property">courseCode</span> === act.<span class="property">courseCode</span> &amp;&amp; added.<span class="property">category</span> !== act.<span class="property">category</span>) &#123;</span><br><span class="line">                sectionStatus.<span class="property">value</span>[act.<span class="property">crn</span>] = <span class="string">&#x27;Incompatible&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (added.<span class="property">day</span> === act.<span class="property">day</span> &amp;&amp; added.<span class="property">endHour</span> &gt;= act.<span class="property">startHour</span> &amp;&amp; added.<span class="property">startHour</span> &lt;= act.<span class="property">endHour</span>) &#123;</span><br><span class="line">                sectionStatus.<span class="property">value</span>[act.<span class="property">crn</span>] = <span class="string">&#x27;Clash&#x27;</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sectionStatus.<span class="property">value</span>[act.<span class="property">crn</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            sectionStatus.<span class="property">value</span>[act.<span class="property">crn</span>] = <span class="string">&#x27;OK&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里要提一下 <code>for ... of ...</code> 和 <code>for ... in ...</code> 的区别。</p>
<p><code>for ... in ...</code> 遍历对象的 key，<code>for ... of ...</code> 遍历对象的 value。</p>
<p>实质上，数组也是一种对象，下标是 key，元素是 value。例如：<code>[1, 2, 3]</code> 的对象表示为 <code>&#123;0: 1, 1: 2, 2: 3&#125;</code>。</p>
<p>可以得到以下对应关系：</p>
<table>
<thead>
<tr>
<th></th>
<th><code>for ... of ...</code></th>
<th><code>for ... in ...</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>数组</td>
<td>元素</td>
<td>下标</td>
</tr>
<tr>
<td>对象</td>
<td>value</td>
<td>key</td>
</tr>
</tbody>
</table>
<h3 id="课程表"><a class="markdownIt-Anchor" href="#课程表"></a> 课程表</h3>
<p>网上虽然有很多课程表的实现，但是全都不适合我，所以只能自己写。</p>
<p>大部分课程表都是固定时间点，然后课程作为二维数组的元素。</p>
<p>但我希望实现的是动态的课程表：</p>
<ul>
<li>初始化时，只给定最早上课时间 09:00 和最晚下课时间 22:50，可能上课日期星期一到星期日。表格中的内容是空的。</li>
<li>添加课程时，将课程放到对应的时间段，如果已经有课了，就显示冲突，不允许添加。</li>
<li><strong>自动合并单元格，用于显示 &gt;1 小时的课程。</strong></li>
<li>点选单元格时，弹出对话框，确认是否删除课程。</li>
</ul>
<p>我不知道怎么设计。我要怎么确定每一行每一列是否有课？然后，是什么课？持续多久？这些信息要怎么保存？</p>
<p>但是如果忽略后面几个问题，只回答第一个问题，还是可以实现的。</p>
<h4 id="template-3"><a class="markdownIt-Anchor" href="#template-3"></a> <code>&lt;template&gt;</code></h4>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;timetable-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:data</span>=<span class="string">&quot;hours&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">border</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:header-cell-style</span>=<span class="string">&quot;&#123;background:&#x27;#d9e5fd&#x27;, color:&#x27;black&#x27;, fontWeight: 1000, textAlign: &#x27;center&#x27;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:span-method</span>=<span class="string">&quot;mergeTimetable&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:row-style</span>=<span class="string">&quot;&#123;height: &#x27;70px&#x27;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:cell-style</span>=<span class="string">&quot;tableCellStyle&quot;</span></span></span><br><span class="line"><span class="tag">            @<span class="attr">cell-click</span>=<span class="string">&quot;deleteFromTimetable&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;Time&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;&#123;row&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;row&#125;&#125;:00<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">v-for</span>=<span class="string">&quot;day in dayKeys&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;day&quot;</span> <span class="attr">:label</span>=<span class="string">&quot;char2Day[day]&quot;</span> <span class="attr">min-width</span>=<span class="string">&quot;4&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;&#123;row&#125;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;act in timetableList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;act.crn&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;act.day === day &amp;&amp; act.startHour === row&quot;</span> <span class="attr">class</span>=<span class="string">&quot;timetable-data&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;timetable-data-title&quot;</span>&gt;</span>&#123;&#123;act.courseCode&#125;&#125; - &#123;&#123;act.section&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;timetable-data-info&quot;</span>&gt;</span>&#123;&#123;act.dayTime&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;timetable-data-info&quot;</span>&gt;</span>&#123;&#123;act.buildingRoom&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>先说明一下几个常量：</p>
<ul>
<li><code>hours = [9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22]</code></li>
<li><code>char2Day = &#123;'M': 'Mon', 'T': 'Tue', 'W': 'Wed', 'R': 'Thu', 'F': 'Fri', 'S': 'Sat', 'U': 'Sun'&#125;</code></li>
<li><code>dayKeys = ['M', 'T', 'W', 'R', 'F', 'S', 'U']</code></li>
</ul>
<hr />
<ul>
<li>整个 <code>el-table</code> 绑定的数据是 <code>hours</code>，每个元素对应一行。</li>
<li>第一列是一个模板，内容为 <code>&#123;&#123;row&#125;&#125;:00</code>，<code>row</code> 是当前行的值，也就是小时数。因此，第一列显示的是 <code>9:00</code>、<code>10:00</code>、<code>11:00</code> 等。</li>
<li>第二列开始是用 <code>v-for</code> 生成的多列模板。</li>
<li>用每个星期生成一列，每个小时生成一行。因此除头行头列外，表格中的每个单元格都是一个小时。</li>
<li>对每个小时，遍历 <code>timetableList</code>，如果有一门课的 <code>day</code> 和 <code>startHour</code> 与当前小时相同，就显示这门课的信息。</li>
<li><code>v-show</code> 是 Vue 的一个指令，类似于 <code>v-if</code>，但是不会销毁元素，只是隐藏。这样，如果一个小时有多门课，就会显示多个元素，而不是覆盖。（<code>v-if</code> 会销毁元素，所以只会显示最后一门课。）</li>
</ul>
<p>是的。判断是否有课的逻辑就是这么简单。只要星期和小时都对上了，就知道是哪门课了。</p>
<p><code>span-method</code> 绑定 <code>mergeTimetable</code> 方法，用于合并单元格。</p>
<h4 id="script-3"><a class="markdownIt-Anchor" href="#script-3"></a> <code>&lt;script&gt;</code></h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">mergeTimetable</span>(<span class="params">&#123;row, column, rowIndex, columnIndex&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (columnIndex === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">rowspan</span>: <span class="number">1</span>, <span class="attr">colspan</span>: <span class="number">1</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> act <span class="keyword">of</span> timetableList.<span class="property">value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (act.<span class="property">day</span> === dayKeys[columnIndex - <span class="number">1</span>] &amp;&amp; act.<span class="property">startHour</span> === row) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="attr">rowspan</span>: act.<span class="property">endHour</span> - act.<span class="property">startHour</span> + <span class="number">1</span>, <span class="attr">colspan</span>: <span class="number">1</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (act.<span class="property">day</span> === dayKeys[columnIndex - <span class="number">1</span>] &amp;&amp; row &gt; act.<span class="property">startHour</span> &amp;&amp; row &lt;= act.<span class="property">endHour</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="attr">rowspan</span>: <span class="number">0</span>, <span class="attr">colspan</span>: <span class="number">0</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">rowspan</span>: <span class="number">1</span>, <span class="attr">colspan</span>: <span class="number">1</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mergeTimetable</code> 每创建一个单元格就会调用一次，参数是当前单元格的信息。</p>
<p>如果当前单元格是第一列（显示小时数），就不合并。</p>
<p>然后，仍然是遍历 <code>timetableList</code>，寻找是否有课程占用当前单元格。</p>
<ul>
<li>如果当前单元格是课程的第一个小时，就返回 <code>rowspan</code> 为课程持续小时数，<code>colspan</code> 为 1。</li>
<li><strong>如果当前单元格是课程的第二个小时及以后，就隐藏该单元格，返回 <code>rowspan</code> 为 0，<code>colspan</code> 为 0。</strong></li>
<li>如果当前单元格没有课程，就不合并。</li>
</ul>
<p>为什么要隐藏呢？因为如果不隐藏，就会出现这样的情况：</p>
<p>假设 A 课程在星期一 9:00-11:50 (占用 9:00, 10:00, 11:00)，B 课程在星期二 10:00-10:50 (占用 10:00)。</p>
<blockquote>
<p>此处 RxCx 表示原本居于第 R 行第 C 列的单元格，Row X Col X 表示显示在第 R 行第 C 列的单元格。都是以 0 开始计数（第 0 行和第 0 列是表头）。</p>
</blockquote>
<p>A 课程匹配到的是 星期一 9:00 (R1C1)，<code>rowspan</code> 为 3，<code>colspan</code> 为 1，合并了 R1C1、R2C1、R3C1。</p>
<p>但是实际上 R2C1 和 R3C1 并没有消失，也并不像 Excel 那样合并了。</p>
<p>它们仍然要显示出来。Col 1 挤不下了，所以它们会向右平移到 Col 2。</p>
<table>
<thead>
<tr>
<th></th>
<th>Col 1</th>
<th>Col 2</th>
<th>Col 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>Row 1</td>
<td>R1C1</td>
<td>R1C2</td>
<td>R1C3</td>
</tr>
<tr>
<td>Row 2</td>
<td>R1C1 (2)</td>
<td>R2C1</td>
<td>R2C2</td>
</tr>
<tr>
<td>Row 3</td>
<td>R1C1 (3)</td>
<td>R3C1</td>
<td>R3C2</td>
</tr>
<tr>
<td>Row 4</td>
<td>R4C1</td>
<td>R4C2</td>
<td>R4C3</td>
</tr>
</tbody>
</table>
<p>如此一来，原本应该占用 R2C2 的 B 课程就被挤到了 Row 3 Col 2，而原本应该显示的 Row 2 Col 2 就空出来了。</p>
<p>而 <strong>隐藏本应该被合并的单元格</strong> 就能解决这个问题。</p>
<table>
<thead>
<tr>
<th></th>
<th>Col 1</th>
<th>Col 2</th>
<th>Col 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>Row 1</td>
<td>R1C1</td>
<td>R1C2</td>
<td>R1C3</td>
</tr>
<tr>
<td>Row 2</td>
<td>R1C1 (2)</td>
<td>R2C2</td>
<td>R2C3</td>
</tr>
<tr>
<td>Row 3</td>
<td>R1C1 (3)</td>
<td>R3C2</td>
<td>R3C3</td>
</tr>
<tr>
<td>Row 4</td>
<td>R4C1</td>
<td>R4C2</td>
<td>R4C3</td>
</tr>
</tbody>
</table>
<p>在处理完这个问题之后，课程表的基本功能就实现了。</p>
<p>点击单元格时，弹出对话框，确认是否删除课程是用 <code>deleteFromTimetable()</code> 实现的，并调用 <code>updateSectionStatus()</code> 和 <code>saveLocalStorage()</code>。略过。</p>
<h3 id="杂项"><a class="markdownIt-Anchor" href="#杂项"></a> 杂项</h3>
<h4 id="localstorage"><a class="markdownIt-Anchor" href="#localstorage"></a> <code>LocalStorage</code></h4>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">saveLocalStorage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;timetableList&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(timetableList.<span class="property">value</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadLocalStorage</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;timetableList&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">        timetableList.<span class="property">value</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="初始化"><a class="markdownIt-Anchor" href="#初始化"></a> 初始化</h4>
<p>打开页面时，需要初始化课程列表——进行一次空搜索，显示所有课程。</p>
<p>此外，读取 LocalStorage 中的数据，更新课程表。</p>
<h2 id="结语"><a class="markdownIt-Anchor" href="#结语"></a> 结语</h2>
<p>作为 Vue 的练手项目，这个项目还是很让我满意的。</p>
<p>不过，代码组织、数据结构、规范等方面我是一概不懂的，所以写得很乱而且很难维护。</p>
<p>设计思路也很混乱，很多地方都是现学现卖，好在最后还是实现了想要的功能。</p>
<p>此外，CSS 非常简陋，没有考虑 UI/UX 和响应式，在手机上看表格会很难受。</p>
<p><s>如果有大佬看到这篇文章，希望能给我一些指导。</s></p>
<p>感谢阅读！</p>



<div class="article-footer reveal fs14"><section id="license"><div class="header"><span>许可协议</span></div><div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh">署名-相同方式共享 4.0 国际许可协议</a>，转载请注明出处。</p>
</div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2023/CS3334Midterm/">CS3334: Data Structures - Midterm</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2023/202309/">2023 年 9 月</a></div></section></div>






  <div class='related-wrap md-text reveal' id="comments">
    <section class='header cmt-title cap theme'>
      快来参与讨论吧
    </section>
    <section class='body cmt-body beaudar'>
      

<svg class="loading" style="vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg>

<div id="beaudar" repo="mojimoon/blog-comments" issue-term="pathname" theme="preferred-color-scheme" input-position="top" comment-order="desc" loading="false" branch="main"></div>

    </section>
  </div>



      
<footer class="page-footer reveal fs12"><hr><div class="sitemap"><div class="sitemap-group"><span class="fs14">博客</span><a href="/">近期</a><a href="/categories/">分类</a><a href="/archives/">归档</a></div><div class="sitemap-group"><span class="fs14">站点</span><a target="_blank" rel="noopener" href="https://steamcommunity.com/id/unreset/">Steam</a><a target="_blank" rel="noopener" href="https://bgm.tv/user/788548">Bangumi</a><a target="_blank" rel="noopener" href="https://github.com/mojimoon">Github</a></div><div class="sitemap-group"><span class="fs14">社交</span><a href="/2023/about/">关于</a><a href="/">友链</a><a href="/">留言板</a></div></div><div class="text"><p><a target="_blank" rel="noopener" href="https://github.com/mojimoon">@mojimoon</a> Overclocked by <a target="_blank" rel="noopener" href="https://xaoxuu.com/wiki/stellar/">Stellar</a></p>
</div></footer>

      <div class='float-panel mobile-only blur' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg>
  </button>
</div>

    </div>
  </div>
  <div class='scripts'>
    <script type="text/javascript">
  const stellar = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // 从 butterfly 和 volantis 获得灵感
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = stellar.config.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.version = '1.19.0';
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.19.0';
  stellar.config = {
    date_suffix: {
      just: '刚刚',
      min: '分钟前',
      hour: '小时前',
      day: '天前',
      month: '个月前',
    },
    root : '/',
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://gcore.jsdelivr.net/npm/jquery@3.6.2/dist/jquery.min.js'
  };

  if ('local_search') {
    stellar.search = {};
    stellar.search.service = 'local_search';
    if (stellar.search.service == 'local_search') {
      let service_obj = Object.assign({}, {"field":"all","path":"/search.json","content":true,"sort":"-date"});
      stellar.search[stellar.search.service] = service_obj;
    }
  }

  // stellar js
  stellar.plugins.stellar = Object.assign({"sites":"/js/plugins/sites.js","friends":"/js/plugins/friends.js","ghinfo":"/js/plugins/ghinfo.js","timeline":"/js/plugins/timeline.js","linkcard":"/js/plugins/linkcard.js","fcircle":"/js/plugins/fcircle.js","weibo":"/js/plugins/weibo.js"});

  stellar.plugins.marked = Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js");
  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/vanilla-lazyload@17.8.3/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.css","js":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://gcore.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://gcore.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti@0.9.2/umd/heti.min.css","js":"https://unpkg.com/heti@0.9.2/umd/heti-addon.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.copycode = Object.assign({"enable":true,"js":"/js/plugins/copycode.js","default_text":"Copy","success_text":"Copied"});
  }
</script>

<!-- required -->

  
<script src="/js/main.js" async></script>



<!-- optional -->

  <script>
  function loadBeaudar() {
    const els = document.querySelectorAll("#comments #beaudar");
    if (els.length === 0) return;
    els.forEach((el, i) => {
      try {
        el.innerHTML = '';
      } catch (error) {
        console.log(error);
      }
      var script = document.createElement('script');
      script.src = 'https://beaudar.lipk.org/client.js';
      script.async = true;
      for (let key of Object.keys(el.attributes)) {
        let attr = el.attributes[key];
        if (['class', 'id'].includes(attr.name) === false) {
          script.setAttribute(attr.name, attr.value);
        }
      }
      el.appendChild(script);
    });
  }
  window.addEventListener('DOMContentLoaded', (event) => {
      loadBeaudar();
  });
</script>




<!-- inject -->


  </div>
</body>
</html>
